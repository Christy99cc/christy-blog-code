---
title: "ã€è®ºæ–‡é˜…è¯»ã€‘Pose Recognition with Cascade Transformers"
date: 2021-08-08T08:30:00.000+00:00
tags:
- å§¿æ€ä¼°è®¡
- è®ºæ–‡é˜…è¯»
categories: ''

---
> å†™åœ¨å‰ï¼š
> è®°å½•ğŸ“


## ç›¸å…³ä¿¡æ¯ğŸ’»

> è®ºæ–‡å‘è¡¨åœ¨CVPR2021
> 
> å‘è¡¨å•ä½ï¼šä¸­å›½ç§‘å­¦é™¢å¤§å­¦ã€æ¸…åå¤§å­¦ã€åœ£è¿­æˆˆåŠ åˆ©ç¦å°¼äºšå¤§å­¦
> 

- è®ºæ–‡åœ°å€ï¼š[http://arxiv.org/abs/2104.06976](http://arxiv.org/abs/2104.06976)
- ä»£ç åœ°å€ï¼š[https://github.com/mlpc-ucsd/PRTR](https://github.com/mlpc-ucsd/PRTR)

## ä¸»è¦åˆ›æ–°ç‚¹

- **åŸºäºTransformer**çš„äººä½“å§¿æ€ä¼°è®¡ï¼ˆè®ºæ–‡ä¸­è¯´æ˜¯ç¬¬ä¸€ç¯‡ï¼‰


## è´¡çŒ®ç‚¹ğŸ’¡

> æ ¹æ®è®ºæ–‡

1. æå‡ºäº†ä¸€ç§é€šè¿‡æ„å»ºçº§è”Transformersçš„åŸºäºå›å½’çš„äººä½“å§¿æ€è¯†åˆ«æ–¹æ³•ã€‚

2. ä¸¤ç§ç±»å‹çš„çº§è”Transformer:
    - two-stageï¼Œç¬¬2ä¸ªTransformerä½¿ç”¨ç¬¬1ä¸ªTransformeræ£€æµ‹åˆ°çš„å›¾åƒpatch
    - end-to-endï¼Œä½¿ç”¨äº†spatial Transformer network (STN) 
    
3. å…³é”®ç‚¹çš„å¯è§†åŒ–

## æ–¹æ³•

ä¸¤ç§Transformerå¦‚ä¸‹ï¼š

![prtr-2-stage](https://x.arcto.xyz/r77JrM/prtr-2-stage.png)
<center>[two-stageçš„]</center>

**two-stage**ï¼š TRansformer (PRTR) ä¸¤é˜¶æ®µå˜ä½“çš„å§¿æ€è¯†åˆ«æ¶æ„ã€‚
- é¦–å…ˆï¼Œåˆ©ç”¨å…¨å›¾å›¾åƒç‰¹å¾å’Œç»å¯¹ä½ç½®ç¼–ç ï¼Œäººä½“æ£€æµ‹Transformerä½¿ç”¨ä¸€ç»„å­¦ä¹ çš„äººæŸ¥è¯¢æ£€æµ‹å›¾ä¸­çš„äººã€‚
- åœ¨è¿‡æ»¤èƒŒæ™¯æŸ¥è¯¢åï¼Œæˆ‘ä»¬ç”¨é¢„æµ‹æ¡†è£å‰ªåŸå§‹å›¾åƒã€‚
- å°†è£å‰ªåçš„å›¾åƒå’Œç›¸å¯¹äºç›¸åº”è¾¹ç•Œæ¡†çš„ä½ç½®ç¼–ç ä¸€èµ·è¾“å…¥ä¸€ä¸ªå…³é”®ç‚¹æ£€æµ‹Transformerã€‚
- æœ€åï¼Œé€šè¿‡<u>åŒˆç‰™åˆ©ç®—æ³•</u>ä»ä¸€ä¸ªæ›´å¤§çš„å…³é”®ç‚¹æŸ¥è¯¢é›†åˆä¸­è¯»å‡ºJä¸ªå…³é”®ç‚¹ã€‚å…³é”®ç‚¹æ£€æµ‹Transformerä»¥çŸ¢é‡åŒ–çš„æ–¹å¼å¤„ç†æ‰€æœ‰éèƒŒæ™¯å…³é”®ç‚¹proposalsã€‚h(0)è¡¨ç¤ºå‡è®¾(æŸ¥è¯¢)ï¼Œé€šè¿‡Transformerè§£ç å™¨å°†ç‰¹å¾å‘é‡æç‚¼ä¸ºæœ€ç»ˆçš„é¢„æµ‹y^ã€‚

![prtr-end-to-end](https://x.arcto.xyz/6FD1so/prtr-end-to-end.png)
<center>[end-to-endçš„]</center>
**end-to-end**ï¼šåŸºäºTRansformer (PRTR)ç«¯åˆ°ç«¯å˜ä½“çš„å§¿æ€è¯†åˆ«æ¶æ„ã€‚å¯¹äºç«¯åˆ°ç«¯å­¦ä¹ ï¼Œæˆ‘ä»¬æ²¡æœ‰åœ¨RGBå›¾åƒçº§åˆ«ä¸Šè¿›è¡Œè£å‰ªï¼Œè€Œæ˜¯å¯¹éª¨å¹²ç”Ÿæˆçš„å¤šå±‚ç‰¹å¾é‡‡ç”¨å¯å¾®åˆ†åŒçº¿æ€§é‡‡æ ·ï¼Œä¸ºå…³é”®ç‚¹æ£€æµ‹Transformeræä¾›äº†æ”¾å¤§å’Œå¤šå±‚æ¬¡çš„ç‰¹å¾ã€‚

### äººä½“æ£€æµ‹Transformer
- è‡ªé¡¶å‘ä¸‹çš„æ–¹å¼è§£å†³å¤šäººå§¿æ€è¯†åˆ«é—®é¢˜ï¼ŒåŸºäºDEtection Transformer (DETR)ï¼Œé‡‡ç”¨Transformeræ¶æ„ä½œä¸ºç¬¬ä¸€é˜¶æ®µäººä½“æ£€æµ‹çš„backboneã€‚
- åœ¨ç¼–ç å™¨é˜¶æ®µï¼Œç”±CNNç”Ÿæˆçš„å›¾åƒç‰¹å¾è¢«æ‰å¹³åŒ–å¹¶é€å…¥Transformerç¼–ç å™¨ä»¥ç”Ÿæˆä¸Šä¸‹æ–‡åŒ–çš„å›¾åƒç‰¹å¾
- åœ¨è§£ç å™¨é˜¶æ®µï¼Œç»™å®šä¸€ç»„å›ºå®šçš„å­¦ä¹ åˆ°çš„query embeddingï¼ˆæŸ¥è¯¢åµŒå…¥ï¼‰ä½œä¸ºè¾“å…¥ï¼ŒTransformerè§£ç å™¨æ ¹æ®å›¾åƒç‰¹å¾çš„ä¸Šä¸‹æ–‡æ¨ç†ç›®æ ‡ä¹‹é—´çš„å…³ç³»ï¼Œå¹¶è¡Œè¾“å‡ºæ‰€æœ‰çš„ç›®æ ‡queriesã€‚
- ä½¿ç”¨**åˆ†ç±»å¤´**å°†ç›®æ ‡åˆ†ç±»ä¸ºäººæˆ–èƒŒæ™¯ï¼ˆç©ºé›†ï¼‰ï¼Œå¹¶ä½¿ç”¨4é€šé“çš„**å›å½’å¤´**é¢„æµ‹è¾¹ç•Œæ¡†ã€‚


### å…³é”®ç‚¹æ£€æµ‹Transformer

  å¾—åˆ°è¾¹ç•Œæ¡†åï¼Œå¯¹RGBå›¾åƒè¿›è¡Œè£å‰ªï¼Œå¹¶ä½¿ç”¨å¦ä¸€ä¸ªCNNä¸»å¹²æ¥å¾—åˆ°äººçš„ç‰¹å¾å›¾ã€‚å› ä¸ºåªæœ‰åŒ¹é…çš„æŸ¥è¯¢æ¶‰åŠè®¡ç®—å…³é”®ç‚¹æ£€æµ‹Transformerçš„æŸå¤±ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿‡æ»¤æ‰äº†ä¸åŒ¹é…çš„æŸ¥è¯¢ã€‚åƒäººæ£€æµ‹çš„è¿‡ç¨‹ä¸­,æˆ‘ä»¬ä½¿ç”¨çš„encoder-decoderæ¶æ„Transformeré¢„æµ‹å¹¶è¡Œçš„æ–¹å¼ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨å¦ä¸€ç»„æŸ¥è¯¢(Qä»£è¡¨æ•°é‡)ã€‚æœ€åï¼Œä¸€ä¸ªåˆ†ç±»å¤´é¢„æµ‹åŒ…æ‹¬Jç§ç±»å‹çš„å…³èŠ‚ã€èƒŒæ™¯(âˆ…)ã€2å£°é“å›å½’å¤´è¾“å‡ºæ¯ä¸ªå…³é”®ç‚¹çš„åæ ‡ã€‚
  

  ç”±äºPRTRæ¨æ–­å‡ºæ¯”ground truth(Jä»£è¡¨æ•°é‡)æ›´å¤§çš„é¢„æµ‹æ•°é‡ï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å®ƒä»¬ä¹‹é—´çš„åŒ¹é…æ¥è®¡ç®—æŸå¤±ã€‚æˆ‘ä»¬å°†è¯¥åŒ¹é…é—®é¢˜è¡¨è¿°ä¸ºæœ€ä¼˜äºŒéƒ¨åŒ¹é…é—®é¢˜ï¼Œè¯¥é—®é¢˜å¯ç”±[åŒˆç‰™åˆ©ç®—æ³•](https://zhuanlan.zhihu.com/p/96229700)æœ‰æ•ˆåœ°æ±‚è§£ã€‚å…·ä½“æ¥è¯´ï¼Œæˆ‘ä»¬è¯•å›¾æ‰¾åˆ°ä¸€ä¸ªå†…å°„å‡½æ•°Ïƒâˆˆ[J]â†’[Q]ï¼Œå®ƒé¦–å…ˆä»¥ç¦»æ•£çš„æ–¹å¼ä½¿åŒ¹é…ä»£ä»·Cæœ€å°:

$$
\mathcal{C}=\underset{\sigma}{\arg \min } \sum_{i}^{J} \mathcal{C}\left(y_{i}, \hat{y}_{\sigma(i)}\right)
$$

å…¶ä¸­ï¼Œ$\hat{y}_{\sigma(i)}$ ä»£è¡¨ä¸ç¬¬iä¸ªå…³é”®ç‚¹ç›¸åŒ¹é…çš„é¢„æµ‹ã€‚


åœ¨è®­ç»ƒé˜¶æ®µï¼Œæˆ‘ä»¬æ··åˆä½¿ç”¨åˆ†ç±»æ¦‚ç‡å’Œåæ ‡åå·®æ¥åŒ¹é…æŸ¥è¯¢ã€‚ä¾‹å¦‚ï¼Œç¬¬iä¸ªå…³é”®ç‚¹ä¸å…¶åŒ¹é…çš„æŸ¥è¯¢Ïƒ(i)çš„ä»£ä»·å‡½æ•°ä¸ºï¼š

$$
\mathcal{C}_{i}=-\hat{p}_{\sigma(i)}\left(c_{i}\right)+\left\|b_{i}-\hat{b}_{\sigma(i)}\right\|
$$

å…¶ä¸­ï¼Œ$\hat{p}_{\sigma(i)}$ æ˜¯æŸ¥è¯¢çš„ç±»æ¦‚ç‡ï¼Œ $c_{i}$ æ˜¯ç¬¬iä¸ªå…³é”®ç‚¹çš„ç±»æ ‡ç­¾ã€‚ç„¶è€Œï¼Œåœ¨æ¨æ–­é˜¶æ®µï¼Œæˆ‘ä»¬ä¸èƒ½è®¿é—®ground-truthå…³é”®ç‚¹åæ ‡ï¼Œå› æ­¤æˆ‘ä»¬åªä½¿ç”¨åˆ†ç±»æ¦‚ç‡å°†JåŸå‹å…³é”®ç‚¹ä¸æŸ¥è¯¢åŒ¹é…ã€‚æ‰€ä»¥ï¼Œç¬¬iä¸ªå…³é”®ç‚¹çš„åŒ¹é…ä»£ä»·å¯ä»¥ç®€å•åœ°è¡¨è¿°ä¸ºï¼š
$$
\mathcal{C}_{i}=-\hat{p}_{\sigma(i)}\left(c_{i}\right)
$$

äºŒéƒ¨åŒ¹é…ç®—æ³•åï¼Œè¿”å›åŒ¹é…çš„Jä¸ªå…³é”®ç‚¹ä½œä¸ºé¢„æµ‹ã€‚
æ¨¡å‹çš„æŸå¤±å‡½æ•°æ˜¯é€šè¿‡å¯¹åŒ¹é…æŸ¥è¯¢ï¼Œå°†æ–¹ç¨‹2ä¸­çš„è´Ÿæ¦‚ç‡æ›¿æ¢ä¸ºè´Ÿå¯¹æ•°ä¼¼ç„¶$-\log \hat{p}_{\sigma(i)}\left(c_{i}\right)$å¾—åˆ°çš„ã€‚å¯¹äºä¸åŒ¹é…çš„æŸ¥è¯¢ï¼Œæˆ‘ä»¬åªåå‘ä¼ æ’­åˆ†ç±»æŸå¤±ã€‚ä¸ºäº†è§£å†³âˆ…classé€ æˆçš„ç±»å¤±è¡¡ï¼Œæˆ‘ä»¬å°†å…¶å¯¹æ•°æ¦‚ç‡é¡¹æƒé‡è®¾ä¸º0.1ã€‚


### ä½¿ç”¨ STN çš„å¤šå±‚è£å‰ª
åœ¨å‰ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬ä»‹ç»äº†ä¸€ä¸ªä¸¤é˜¶æ®µçš„pipelineã€‚ç„¶è€Œï¼Œåœ¨ç«¯åˆ°ç«¯ç†å¿µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›æ¨¡å‹æ˜¯ç«¯åˆ°ç«¯å¯è°ƒçš„ï¼Œä»¥åˆ©ç”¨äººä½“æ£€æµ‹å’Œå…³é”®ç‚¹è¯†åˆ«ä»»åŠ¡ä¹‹é—´çš„ååŒä½œç”¨ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆå¹¶äº†**STN**ï¼Œç›´æ¥ä»ç¬¬ä¸€ä¸ªCNNéª¨å¹²ç”Ÿæˆçš„ç‰¹å¾å›¾ä¸­è£å‰ªå‡ºå…³é”®ç‚¹æ£€æµ‹Transformeræ‰€éœ€çš„å›¾åƒç‰¹å¾ã€‚è¿™ç§è£å‰ªæ“ä½œä¸ä»…å¯¹ç‰¹å¾æ˜ å°„æ˜¯å¯å¾®çš„ï¼Œè€Œä¸”å¯¹è¾¹ç•Œæ¡†åæ ‡ä¹Ÿæ˜¯å¯å¾®çš„ã€‚

ä¾‹å¦‚ï¼Œç”±$b = \left(x_{\text {left }}, x_{\text {right }}, y_{\text {top }}, x_{\text {down }}\right)$ç”Ÿæˆçš„$w Ã— h$ç½‘æ ¼å¯ä»¥è¡¨ç¤ºä¸º:

$$
x_{i}=\frac{w-i}{w} x_{\mathrm{left}}+\frac{i}{w} x_{\mathrm{right}}
$$

$$
y_{j}=\frac{h-j}{h} y_{\mathrm{top}}+\frac{j}{h} y_{\mathrm{down}}
$$

å…¶ä¸­ï¼Œ$b$ç›¸å¯¹äºåŸå§‹å›¾åƒï¼Œ$w Ã— h$ä¸ºå…³é”®ç‚¹æ£€æµ‹Transformeræ‰€éœ€çš„ç‰¹å¾å›¾å°ºå¯¸ã€‚
ä¸ºäº†å‡è½»å…³é”®ç‚¹è¯†åˆ«ä¸­å¸¸è§çš„åˆ†è¾¨ç‡æŒ‘æˆ˜ï¼Œæˆ‘ä»¬ä½¿ç”¨**åŒçº¿æ€§æ ¸**å°†ç½‘æ ¼åº”ç”¨äºCNNä¸»å¹²ä¸åŒä¸­é—´å±‚ç”Ÿæˆçš„ä¸åŒå°ºåº¦çš„ç‰¹å¾å›¾ã€‚
ç”¨Uè¡¨ç¤ºåŸå§‹çš„W Ã— Hç‰¹å¾å›¾ï¼Œå¯å¾®é‡‡æ ·è¿‡ç¨‹å¯ä»¥è¡¨ç¤ºä¸º:
$$
V_{i j}=\sum_{m, n} U_{n m} \max \left(0,1-\left|x_{i}-m\right|\right) \max \left(0,1-\left|y_{j}-n\right|\right)
$$

åœ¨å¾—åˆ°ä¸€ç³»åˆ—ç›¸åŒå¤§å°çš„å›¾åƒç‰¹å¾åï¼Œæˆ‘ä»¬å°†å®ƒä»¬è¿æ¥æˆä¸€ä¸ªå•ä¸€çš„ç‰¹å¾å›¾ï¼Œç”¨äºå…³é”®ç‚¹æ£€æµ‹Transformerã€‚è¿™ç§å¤šå±‚è£å‰ªå˜ä½“**å›¾[end-to-end]**æ‰€ç¤ºã€‚

## å®éªŒğŸ§ª
### å®éªŒè®¾ç½®

#### æ•°æ®é›†
- COCO Keypoint Detection task
- MPII Human Pose Dataset

#### è¯„ä»·æ ‡å‡†
- Object Keypoint Similarity (OKS) for COCO
- Percentage of Correct Keypoints (PCK) for MPII

### å®éªŒç»“æœ
- COCO dataset
![prtr-coco-result-1](https://x.arcto.xyz/YElJVU/prtr-coco-result-1.png)
![prtr-coco-result-2](https://x.arcto.xyz/mQwSwv/prtr-coco-result-2.png)
- MPII val dataset
![prtr-mpii-result](https://x.arcto.xyz/CRnCCr/prtr-mpii-result.png)

## å‚è€ƒé“¾æ¥ğŸ”—
- [Pose Recognition with Cascade Transformers è®ºæ–‡ç¬”è®°](https://www.yuque.com/jinluzhang/researchblog/prtr)


### å›é¡¾
- End-to-end object detection with transformersï¼ˆDETRï¼‰ECCV 2020
- Cascaded pose regressionï¼ˆstep-by-step regressionï¼‰
- Locality-constrained spatial transformer network for video crowd counting.(STN)

> â¬†ï¸è¿™äº›è¿˜éœ€è¦å†å»çœ‹çœ‹è¡¥å……ä¸€ä¸‹

### ä»€ä¹ˆæ˜¯Transformer
- [ååˆ†é’Ÿç†è§£Transformer](https://zhuanlan.zhihu.com/p/82312421)
- [è¯¦è§£Transformer ï¼ˆAttention Is All You Needï¼‰](https://zhuanlan.zhihu.com/p/48508221)